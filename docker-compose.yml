services:
  router:
    build: ./router
    container_name: agent-router
    env_file: .env
    environment:
      - WORKSPACE_ROOT=${WORKSPACE_ROOT}
    ports:
      - "8080:8080"
    volumes:
      - workspaces:${WORKSPACE_ROOT}
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - runner
      - browser
    restart: unless-stopped

  runner:
    build: ./runner
    container_name: agent-runner
    # no ports needed; router talks via docker exec OR HTTP if you add it later
    volumes:
      - workspaces:${WORKSPACE_ROOT}
    working_dir: ${WORKSPACE_ROOT}
    restart: unless-stopped

  browser:
    build: ./browser
    container_name: agent-browser
    environment:
      - WORKSPACE_ROOT=${WORKSPACE_ROOT}
      - BROWSER_ALLOWED_DOMAINS=${BROWSER_ALLOWED_DOMAINS}
    volumes:
      - workspaces:${WORKSPACE_ROOT}
    # optional: expose for debugging
    ports:
      - "9222:9222"
    restart: unless-stopped

volumes:
  workspaces:
